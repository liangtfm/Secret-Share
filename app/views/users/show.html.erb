<script>

  $(document).ready(function () {
    $('#new-secret-form').on("submit", function (event) {

      event.preventDefault();
      var formData = $(this).serialize();
      var formObject = $(this).serializeJSON();
      var form = $(this);

      $.ajax({

        url: "<%= secrets_url %>",
        type: "POST",
        data: formData,
        success: function() {
          var label = $(form).children()[1];
          var input = $(label).children();

          $(input).val("");
          $('#secrets').prepend("<li>"+formObject.secret.title+"</li>");
        }

      });

    });

    var selectBox = $('#tag-selection').html();

    $('#add-tag').on('click', function(event){

      var $section = $('#tag-selection');
      $section.append(selectBox);

    });


  });

</script>

<script type="application/json">

</script>


<h1><%= @user.username %></h1>

<%= render 'secrets/form' %>


<h2>Secrets</h2>
<ul id="secrets">
  <% @user.received_secrets.each do |secret| %>
    <li><%= secret.title %></li>
    <ul>
      <% secret.tags.each do |tag| %>
        <li><%= tag.name %></li>
      <% end %>
    </ul>
  <% end %>
</ul>
